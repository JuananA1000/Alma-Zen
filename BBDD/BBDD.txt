-- Creamos la base de datos
CREATE SCHEMA `almazen` ;

-- Creamos las tablas:
-- En primer lugar, de usuarios:
CREATE TABLE `almazen`.`usuarios` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `User` VARCHAR(45) NOT NULL,
  `Password` VARCHAR(45) NULL,
  `Rol` VARCHAR(45) NULL,
  PRIMARY KEY (`id`));

-- Empresas:
CREATE TABLE `almazen`.`empresas` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `Nombre_Empresa` varchar(45) NOT NULL,
  PRIMARY KEY (`id`)
);

-- Empleados:
CREATE TABLE `almazen`.`empleados` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `id_empresa` int(11) NOT NULL,
  `nombre` varchar(45) NOT NULL,
  `apellidos` varchar(45) NOT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_empleados_empresas_idempresa` (`id_empresa`),
  CONSTRAINT `fk_empleados_empresas_idempresa`
  FOREIGN KEY (`id_empresa`) REFERENCES `empresas` (`id`)
  ON DELETE NO ACTION ON UPDATE NO ACTION
);

-- Útiles de la empresa:
CREATE TABLE `almazen`.`utiles` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `idEmpresa` int(11) NOT NULL,
  `Marca` varchar(45) NOT NULL,
  `Modelo` varchar(45) NOT NULL,
  `Categoria` varchar(45) NOT NULL,
  `estado` varchar(100) DEFAULT NULL,
  `Herramienta_Vehiculo` varchar(45) NOT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_utiles_empresas_idempresa` (`idEmpresa`),
  CONSTRAINT `fk_utiles_empresa`
  FOREIGN KEY (`idEmpresa`) REFERENCES `empresas` (`id`)
  ON DELETE NO ACTION ON UPDATE NO ACTION
);

-- Y por último, la relación que recogerá el historial de las herramientas
-- adquiridas por cada empleado:
CREATE TABLE `almazen`.`emple_util` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `idempleado` int(11) NOT NULL,
  `idutil` int(11) NOT NULL,
  `fecha_hora` datetime NOT NULL,
  `isdevuelto` bit(1) NOT NULL,
  `incidencia` varchar(200) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_empleherra_empleados_id` (`idempleado`),
  KEY `fk_empleherra_utiles_id` (`idutil`),
  CONSTRAINT `fk_empleherra_empleados` FOREIGN KEY (`idempleado`) REFERENCES `empleados` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_empleherra_utiles` FOREIGN KEY (`idutil`) REFERENCES `utiles` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
);

-- A continuación, insertamos  datos a cada una de las tablas:
INSERT INTO almazen.usuarios (user, password, rol)
VALUES
    ('admin', 'admin', 'admin'),
    ('empleado', 'empleado', 'empleado');

INSERT INTO almazen.empresas (nombre_empresa)
VALUES
    ('Empresa A'),
	  ('Empresa B'),
    ('Empresa c');

INSERT INTO almazen.empleados (id_empresa, nombre, apellidos) -- 
VALUES
    ('8', 'Antonio','Antunez'),
	 ('8', 'Baltasar','Baeza'),
    ('9', 'Carlos','Castro');

INSERT INTO almazen.utiles (idempresa, Marca, Modelo, Categoria, Estado, Herramienta_Vehiculo)
VALUES
    ('8', 'Hilti','TE-60','Pistolete','','Herramienta'),
	('8', 'Hilti','TE-100','Rompedor','','Herramienta'),
    ('9', 'Caterpillar','Retro-MAX','Retroexcavadora','','Vehiculo'),
    ('10', 'Bosch','GWS 20-230','Radial','','Herramienta');